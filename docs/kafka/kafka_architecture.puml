@startuml kafka_architecture
title Kafka Messaging Architecture

skinparam packageStyle rectangle
skinparam linetype ortho
skinparam component {
    BorderColor black
    BackgroundColor lightblue
}
skinparam queue {
    BorderColor red
    BackgroundColor pink
}

package "EV P" {
    [DocumentProducer] as DP
    [RAGProducer] as RP
    [ExtractionProducer] as EP
    [QueryProducer] as QP
}

package "KMT" {
    queue "document-received" as DR
    queue "workflow-initialized" as WI
    queue "chunking-complete" as CC
    queue "embedding-ready" as ER
    queue "ingestion-complete" as IC
    queue "field-init-complete" as FIC
    queue "agent-scaling-complete" as ASC
    queue "extraction-tasks" as ET
    queue "extraction-complete" as EC
    queue "query-received" as QR
    queue "rag-query-complete" as RQC
    queue "structured-query-complete" as SQC
    queue "hybrid-query-complete" as HQC
}

package "EV C" {
    [DocumentConsumer] as DC
    [RAGConsumer] as RC
    [ExtractionConsumer] as EXC
    [QueryConsumer] as QC
}

DP --> DR
DP --> WI

RP --> CC
RP --> ER
RP --> IC

EP --> FIC
EP --> ASC
EP --> ET
EP --> EC

QP --> QR
QP --> RQC
QP --> SQC
QP --> HQC

DR --> DC
WI --> DC

CC --> RC
ER --> RC
IC --> RC

FIC --> EXC
ASC --> EXC
ET --> EXC
EC --> EXC

QR --> QC
RQC --> QC
SQC --> QC
HQC --> QC


@enduml